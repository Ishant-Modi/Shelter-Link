<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-translate="job_portal_title">Job Portal - Shelter Link</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="assets/css/tailwind-styles.css" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#2563eb",
              secondary: "#1e40af",
            },
          },
        },
      };
    </script>
  </head>

  <body class="min-h-screen bg-gray-50">
    <!-- Navigation -->
    <nav class="navbar-modern bg-white shadow-lg">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center">
            <a
              href="dashboard.html"
              class="flex items-center text-xl font-bold text-blue-600"
            >
              <i class="fas fa-network-wired mr-2"></i>
              Shelter Link
            </a>
          </div>

          <div class="flex items-center space-x-4">
            <!-- Language Dropdown -->
            <div class="relative" id="languageDropdown">
              <button
                class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors"
                onclick="toggleLanguageDropdown()"
              >
                <i class="fas fa-globe mr-2"></i>
                <span id="currentLang">English</span>
                <i class="fas fa-chevron-down ml-2"></i>
              </button>
              <div
                class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg z-50 hidden"
                id="languageMenu"
              >
                <div class="py-1">
                  <a
                    href="#"
                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    onclick="changeLanguage('en'); toggleLanguageDropdown();"
                    >English</a
                  >
                  <a
                    href="#"
                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    onclick="changeLanguage('hi'); toggleLanguageDropdown();"
                    >हिंदी</a
                  >
                  <a
                    href="#"
                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    onclick="changeLanguage('bn'); toggleLanguageDropdown();"
                    >বাংলা</a
                  >
                  <a
                    href="#"
                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    onclick="changeLanguage('te'); toggleLanguageDropdown();"
                    >తెలుగు</a
                  >
                  <a
                    href="#"
                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    onclick="changeLanguage('ta'); toggleLanguageDropdown();"
                    >தமிழ்</a
                  >
                </div>
              </div>
            </div>

            <!-- Back to Dashboard -->
            <a href="dashboard.html" class="btn-outline-modern">
              <i class="fas fa-arrow-left mr-2"></i>
              <span data-translate="back_to_dashboard">Back to Dashboard</span>
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <div class="gradient-primary text-white py-16 mt-16">
      <div class="container mx-auto px-4">
        <div class="text-center">
          <h1 class="text-4xl font-bold mb-4" data-translate="job_portal_title">
            Find Your Next Job
          </h1>
          <p
            class="text-xl text-blue-100 mb-8"
            data-translate="job_portal_subtitle"
          >
            Connect with verified employers and find opportunities that match
            your skills
          </p>
        </div>
      </div>
    </div>

    <!-- Search and Filters -->
    <div class="container mx-auto px-4 -mt-8 relative z-10">
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div>
            <label
              class="block text-sm font-medium text-gray-700 mb-2"
              data-translate="search_jobs"
              >Search Jobs</label
            >
            <input
              type="text"
              id="searchInput"
              class="form-input-modern"
              placeholder="Enter job title or keyword..."
              data-translate-placeholder="search_placeholder"
            />
          </div>
          <div>
            <label
              class="block text-sm font-medium text-gray-700 mb-2"
              data-translate="location"
              >Location</label
            >
            <select id="locationFilter" class="form-select-modern">
              <option value="">All Locations</option>
              <option value="Delhi">Delhi</option>
              <option value="Mumbai">Mumbai</option>
              <option value="Chennai">Chennai</option>
              <option value="Bangalore">Bangalore</option>
              <option value="Kolkata">Kolkata</option>
            </select>
          </div>
          <div>
            <label
              class="block text-sm font-medium text-gray-700 mb-2"
              data-translate="job_category"
              >Category</label
            >
            <select id="categoryFilter" class="form-select-modern">
              <option value="">All Categories</option>
              <option value="Construction">Construction</option>
              <option value="Manufacturing">Manufacturing</option>
              <option value="Hospitality">Hospitality</option>
              <option value="Agriculture">Agriculture</option>
              <option value="Domestic Work">Domestic Work</option>
            </select>
          </div>
          <div class="flex items-end">
            <button
              onclick="applyFilters()"
              class="btn-primary-modern w-full"
              data-translate="search_button"
            >
              <i class="fas fa-search mr-2"></i>Search
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Job Listings -->
    <div class="container mx-auto px-4 pb-16">
      <div class="flex justify-between items-center mb-6">
        <h2
          class="text-2xl font-bold text-gray-900"
          data-translate="available_jobs"
        >
          Available Jobs
        </h2>
        <div class="flex items-center space-x-2">
          <span class="text-sm text-gray-600" data-translate="sort_by"
            >Sort by:</span
          >
          <select id="sortFilter" class="form-select-modern w-auto text-sm">
            <option value="date">Latest</option>
            <option value="salary">Highest Salary</option>
            <option value="location">Location</option>
          </select>
        </div>
      </div>

      <!-- Job Cards -->
      <div
        id="jobListingsContainer"
        class="grid grid-cols-1 lg:grid-cols-2 gap-6"
      >
        <!-- Jobs will be populated by JavaScript -->
      </div>

      <!-- Load More Button -->
      <div class="text-center mt-8">
        <button
          id="loadMoreBtn"
          class="btn-secondary-modern"
          onclick="loadMoreJobs()"
          data-translate="load_more"
        >
          Load More Jobs
        </button>
      </div>
    </div>

    <!-- Application Modal -->
    <div
      class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-[60] hidden"
      id="applicationModal"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all"
      >
        <div class="p-6 border-b border-gray-100">
          <div class="flex justify-between items-center">
            <h3
              class="text-xl font-semibold text-gray-900"
              data-translate="apply_for_job"
            >
              Apply for Job
            </h3>
            <button
              onclick="closeApplicationModal()"
              class="text-gray-400 hover:text-gray-600"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        <div class="p-6">
          <form id="applicationForm" class="space-y-4">
            <div>
              <label
                class="block text-sm font-medium text-gray-700 mb-2"
                data-translate="full_name"
                >Full Name</label
              >
              <input
                type="text"
                class="form-input-modern"
                required
                placeholder="Enter your full name"
              />
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 mb-2"
                data-translate="phone_number"
                >Phone Number</label
              >
              <input
                type="tel"
                class="form-input-modern"
                required
                placeholder="Enter your phone number"
              />
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 mb-2"
                data-translate="experience"
                >Experience (Years)</label
              >
              <select class="form-select-modern" required>
                <option value="">Select Experience</option>
                <option value="0-1">0-1 years</option>
                <option value="1-3">1-3 years</option>
                <option value="3-5">3-5 years</option>
                <option value="5+">5+ years</option>
              </select>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 mb-2"
                data-translate="cover_message"
                >Cover Message (Optional)</label
              >
              <textarea
                class="form-input-modern"
                rows="3"
                placeholder="Tell the employer why you're perfect for this job..."
              ></textarea>
            </div>
            <div class="flex space-x-3 pt-4">
              <button type="submit" class="btn-primary-modern flex-1">
                <i class="fas fa-paper-plane mr-2"></i>
                <span data-translate="submit_application"
                  >Submit Application</span
                >
              </button>
              <button
                type="button"
                onclick="closeApplicationModal()"
                class="btn-outline-modern"
              >
                <span data-translate="cancel">Cancel</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Job Details Modal -->
    <div
      class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 hidden"
      id="jobDetailsModal"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-screen overflow-y-auto"
      >
        <div class="p-6 border-b border-gray-100">
          <div class="flex justify-between items-center">
            <h3
              class="text-xl font-semibold text-gray-900"
              id="jobDetailsTitle"
            >
              Job Details
            </h3>
            <button
              onclick="closeJobDetailsModal()"
              class="text-gray-400 hover:text-gray-600"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        <div class="p-6" id="jobDetailsContent">
          <!-- Job details will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/language.js"></script>
    <script src="assets/js/jobs.js"></script>
    <script>
      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize language system first
        if (typeof loadLanguage === "function") {
          const savedLang = localStorage.getItem("selectedLanguage") || "en";
          loadLanguage(savedLang);
        }

        // Load jobs using the correct function name from jobs.js
        if (typeof loadJobListings === "function") {
          loadJobListings();
        } else {
          displayJobs(); // fallback for compatibility
        }
        setupEventListeners();
      });

      function toggleLanguageDropdown() {
        const menu = document.getElementById("languageMenu");
        menu.classList.toggle("hidden");
      }

      // Close dropdown when clicking outside
      document.addEventListener("click", function (event) {
        const dropdown = document.getElementById("languageDropdown");
        const menu = document.getElementById("languageMenu");

        if (!dropdown.contains(event.target)) {
          menu.classList.add("hidden");
        }
      });

      function setupEventListeners() {
        // Search input
        document
          .getElementById("searchInput")
          .addEventListener("input", debounce(applyFilters, 300));

        // Sort change
        document
          .getElementById("sortFilter")
          .addEventListener("change", applyFilters);

        // Application form submit
        document
          .getElementById("applicationForm")
          .addEventListener("submit", handleApplicationSubmit);
      }

      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      function applyFilters() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const location = document.getElementById("locationFilter").value;
        const category = document.getElementById("categoryFilter").value;
        const sort = document.getElementById("sortFilter").value;

        displayJobs(searchTerm, location, category, sort);
      }

      function openApplicationModal(jobId) {
        console.log("Attempting to open application modal for job:", jobId);

        // Close job details modal if it's open
        const jobDetailsModal = document.getElementById("jobDetailsModal");
        if (jobDetailsModal && !jobDetailsModal.classList.contains("hidden")) {
          console.log("Closing job details modal first");
          closeJobDetailsModal();

          // Wait a bit for the modal to close, then open application modal
          setTimeout(() => {
            showApplicationModal(jobId);
          }, 150);
        } else {
          // No job details modal open, show application modal immediately
          showApplicationModal(jobId);
        }
      }

      function showApplicationModal(jobId) {
        console.log("Showing application modal for job:", jobId);

        // Store the job ID for the application
        window.currentJobId = jobId;

        // Get the application modal
        const modal = document.getElementById("applicationModal");

        // Ensure the modal is properly styled
        modal.style.display = "flex";
        modal.classList.remove("hidden");
        modal.classList.add("flex");
        document.body.style.overflow = "hidden";

        // Force a reflow to ensure the modal appears
        modal.offsetHeight;

        console.log("Application modal should now be visible");
        console.log("Modal classes:", modal.className);
        console.log("Modal display style:", modal.style.display);
      }

      function closeApplicationModal() {
        console.log("Closing application modal");
        const modal = document.getElementById("applicationModal");
        modal.classList.add("hidden");
        modal.classList.remove("flex");
        document.body.style.overflow = "auto";

        // Clear the current job ID
        window.currentJobId = null;
      }

      function openJobDetailsModal(jobId) {
        // Use the jobListings from jobs.js
        const job =
          typeof jobListings !== "undefined"
            ? jobListings.find((j) => j.id === jobId)
            : null;

        if (!job) {
          console.error("Job not found:", jobId);
          return;
        }

        document.getElementById("jobDetailsTitle").textContent = job.title;
        document.getElementById("jobDetailsContent").innerHTML =
          generateJobDetailsHTML(job);

        const modal = document.getElementById("jobDetailsModal");
        modal.classList.remove("hidden");
        modal.classList.add("flex");
        document.body.style.overflow = "hidden";
      }

      function closeJobDetailsModal() {
        console.log("Closing job details modal");
        const modal = document.getElementById("jobDetailsModal");
        modal.classList.add("hidden");
        modal.classList.remove("flex");
        document.body.style.overflow = "auto";

        // Small delay to ensure modal is closed before opening another
        setTimeout(() => {
          console.log("Job details modal closed");
        }, 100);
      }

      function generateJobDetailsHTML(job) {
        return `
          <div class="space-y-6">
            <div class="flex items-start justify-between">
              <div>
                <h4 class="text-lg font-semibold text-gray-900">${
                  job.company
                }</h4>
                <p class="text-gray-600 flex items-center">
                  <i class="fas fa-map-marker-alt mr-1"></i>
                  ${job.location}
                </p>
              </div>
              <div class="text-right">
                <div class="text-2xl font-bold text-green-600">${
                  job.salary
                }</div>
                <div class="text-sm text-gray-500">${job.type}</div>
                ${
                  job.verified
                    ? '<span class="badge-modern badge-success-modern mt-2 inline-block">Verified Employer</span>'
                    : ""
                }
              </div>
            </div>
            
            <div>
              <h5 class="font-semibold text-gray-900 mb-2">Job Description</h5>
              <p class="text-gray-700 leading-relaxed">${job.description}</p>
            </div>
            
            <div>
              <h5 class="font-semibold text-gray-900 mb-3">Requirements</h5>
              <ul class="space-y-2">
                ${job.requirements
                  .map(
                    (req) => `
                  <li class="flex items-start text-gray-700">
                    <i class="fas fa-check-circle text-green-500 mr-2 mt-1 flex-shrink-0"></i>
                    <span>${req}</span>
                  </li>
                `
                  )
                  .join("")}
              </ul>
            </div>
            
            <div>
              <h5 class="font-semibold text-gray-900 mb-3">Benefits</h5>
              <ul class="space-y-2">
                ${job.benefits
                  .map(
                    (benefit) => `
                  <li class="flex items-start text-gray-700">
                    <i class="fas fa-star text-yellow-500 mr-2 mt-1 flex-shrink-0"></i>
                    <span>${benefit}</span>
                  </li>
                `
                  )
                  .join("")}
              </ul>
            </div>
            
            <div class="bg-gray-50 p-4 rounded-lg">
              <div class="flex items-center justify-between text-sm text-gray-600">
                <div>
                  <i class="fas fa-calendar mr-1"></i>
                  Posted: ${job.posted}
                </div>
                <div>
                  <i class="fas fa-users mr-1"></i>
                  ${job.applications} applications
                </div>
              </div>
            </div>
            
            <div class="flex space-x-3 pt-4 border-t border-gray-200">
              <button onclick="openApplicationModal('${
                job.id
              }'); event.stopPropagation();" class="btn-primary-modern flex-1">
                <i class="fas fa-paper-plane mr-2"></i>Apply Now
              </button>
              <button onclick="closeJobDetailsModal()" class="btn-outline-modern">
                <i class="fas fa-times mr-2"></i>Close
              </button>
            </div>
          </div>
        `;
      }

      function handleApplicationSubmit(e) {
        e.preventDefault();

        // Show success message
        alert(
          "Application submitted successfully! The employer will contact you soon."
        );

        closeApplicationModal();

        // Reset form
        e.target.reset();
      }

      function loadMoreJobs() {
        // Simulate loading more jobs
        const button = document.getElementById("loadMoreBtn");
        button.innerHTML =
          '<i class="fas fa-spinner fa-spin mr-2"></i>Loading...';
        button.disabled = true;

        setTimeout(() => {
          button.innerHTML = "Load More Jobs";
          button.disabled = false;
          // In a real app, you would load more jobs here
          alert("No more jobs to load");
        }, 1000);
      }

      function getCurrentLanguage() {
        return localStorage.getItem("selectedLanguage") || "en";
      }

      function updateLanguageDisplay() {
        const currentLang = getCurrentLanguage();
        const langDisplay = document.getElementById("currentLang");
        if (langDisplay) {
          const langNames = {
            en: "English",
            hi: "हिंदी",
            bn: "বাংলা",
            te: "తెలుగు",
            ta: "தமிழ்",
            mr: "मराठी",
            gu: "ગુજરાતી",
            kn: "ಕನ್ನಡ",
            ml: "മലയാളം",
            pa: "ਪੰਜਾਬੀ",
            or: "ଓଡ଼ିଆ",
          };
          langDisplay.textContent = langNames[currentLang] || "English";
        }
      }

      // Initialize language display on page load
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(updateLanguageDisplay, 100);
      });

      // Compatibility function for displayJobs if jobs.js doesn't have it
      function displayJobs(searchTerm, location, category, sort) {
        if (
          typeof loadJobListings === "function" &&
          typeof jobListings !== "undefined"
        ) {
          // Use the actual function from jobs.js with filters
          let jobs = [...jobListings]; // Create a copy

          if (searchTerm) {
            jobs = jobs.filter(
              (job) =>
                job.title.toLowerCase().includes(searchTerm) ||
                job.company.toLowerCase().includes(searchTerm) ||
                job.description.toLowerCase().includes(searchTerm)
            );
          }

          if (location) {
            jobs = jobs.filter((job) => job.location.includes(location));
          }

          if (category) {
            jobs = jobs.filter(
              (job) => job.category === category.toLowerCase()
            );
          }

          if (sort) {
            switch (sort) {
              case "salary":
                jobs.sort((a, b) => {
                  const aSalary = parseInt(a.salary.replace(/[^\d]/g, ""));
                  const bSalary = parseInt(b.salary.replace(/[^\d]/g, ""));
                  return bSalary - aSalary;
                });
                break;
              case "location":
                jobs.sort((a, b) => a.location.localeCompare(b.location));
                break;
              default: // date
                // Already sorted by default (newest first)
                break;
            }
          }

          loadJobListings(jobs);
        } else {
          console.error(
            "loadJobListings function or jobListings data not found in jobs.js"
          );
          // Show a loading message
          const container = document.getElementById("jobListingsContainer");
          if (container) {
            container.innerHTML = `
              <div class="text-center py-12 col-span-2">
                <i class="fas fa-spinner fa-spin text-4xl text-gray-400 mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-600 mb-2">Loading jobs...</h3>
                <p class="text-gray-500">Please wait while we fetch available jobs</p>
              </div>
            `;
          }
        }
      }

      // Wrapper functions to make jobs.js compatible with existing HTML
      function applyForJobFromJS(jobId) {
        // Call the jobs.js function and then show our modal
        if (typeof applyForJob === "function") {
          // Set the current job ID for the application form
          window.currentJobId = jobId;
          openApplicationModal(jobId);
        }
      }

      function viewJobDetailsFromJS(jobId) {
        if (typeof viewJobDetails === "function") {
          viewJobDetails(jobId);
        } else {
          openJobDetailsModal(jobId);
        }
      }

      // Override the global functions if jobs.js doesn't handle them properly
      window.viewJobDetails = function (jobId) {
        openJobDetailsModal(jobId);
      };

      window.applyForJob = function (jobId) {
        openApplicationModal(jobId);
      };
    </script>
  </body>
</html>
