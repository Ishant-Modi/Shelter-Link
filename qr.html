<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-translate="qr_title">
      Digital ID & QR Code - MigrantConnect
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="assets/css/tailwind-styles.css" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#2563eb",
              secondary: "#1e40af",
            },
          },
        },
      };
    </script>
  </head>

  <body class="min-h-screen bg-gray-50">
    <!-- Navigation -->
    <nav class="navbar-modern bg-white shadow-lg">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center">
            <a
              href="dashboard.html"
              class="flex items-center text-xl font-bold text-blue-600"
            >
              <i class="fas fa-qrcode mr-2"></i>
              Digital ID
            </a>
          </div>

          <div class="flex items-center space-x-4">
            <!-- Language Dropdown -->
            <div class="relative" id="languageDropdown">
              <button
                class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors"
                onclick="toggleLanguageDropdown()"
              >
                <i class="fas fa-globe mr-2"></i>
                <span id="currentLang">English</span>
                <i class="fas fa-chevron-down ml-2"></i>
              </button>
              <div
                class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg z-50 hidden"
                id="languageMenu"
              >
                <div class="py-1">
                  <a
                    href="#"
                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    onclick="changeLanguage('en'); toggleLanguageDropdown();"
                    >English</a
                  >
                  <a
                    href="#"
                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    onclick="changeLanguage('hi'); toggleLanguageDropdown();"
                    >हिंदी</a
                  >
                  <a
                    href="#"
                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    onclick="changeLanguage('bn'); toggleLanguageDropdown();"
                    >বাংলা</a
                  >
                </div>
              </div>
            </div>

            <!-- Back to Dashboard -->
            <a href="dashboard.html" class="btn-outline-modern">
              <i class="fas fa-arrow-left mr-2"></i>
              <span data-translate="back_to_dashboard">Back to Dashboard</span>
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <div class="gradient-primary text-white py-16 mt-16">
      <div class="container mx-auto px-4">
        <div class="text-center">
          <h1 class="text-4xl font-bold mb-4" data-translate="qr_title">
            Digital Identity & QR Code
          </h1>
          <p class="text-xl text-blue-100 mb-8" data-translate="qr_subtitle">
            Your secure digital identity for quick verification and access to
            services
          </p>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="container mx-auto px-4 -mt-8 relative z-10">
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <button
            onclick="showQRCode()"
            class="flex items-center p-4 bg-blue-50 rounded-xl hover:bg-blue-100 transition-colors"
          >
            <i class="fas fa-qrcode text-2xl text-blue-600 mr-3"></i>
            <div class="text-left">
              <div class="font-semibold text-gray-900" data-translate="show_qr">
                Show QR Code
              </div>
              <div class="text-sm text-gray-600">Display for verification</div>
            </div>
          </button>

          <button
            onclick="downloadQR()"
            class="flex items-center p-4 bg-green-50 rounded-xl hover:bg-green-100 transition-colors"
          >
            <i class="fas fa-download text-2xl text-green-600 mr-3"></i>
            <div class="text-left">
              <div
                class="font-semibold text-gray-900"
                data-translate="download_qr"
              >
                Download QR
              </div>
              <div class="text-sm text-gray-600">Save to device</div>
            </div>
          </button>

          <button
            onclick="shareQR()"
            class="flex items-center p-4 bg-purple-50 rounded-xl hover:bg-purple-100 transition-colors"
          >
            <i class="fas fa-share text-2xl text-purple-600 mr-3"></i>
            <div class="text-left">
              <div
                class="font-semibold text-gray-900"
                data-translate="share_qr"
              >
                Share QR
              </div>
              <div class="text-sm text-gray-600">Send to employer</div>
            </div>
          </button>

          <button
            onclick="printQR()"
            class="flex items-center p-4 bg-orange-50 rounded-xl hover:bg-orange-100 transition-colors"
          >
            <i class="fas fa-print text-2xl text-orange-600 mr-3"></i>
            <div class="text-left">
              <div
                class="font-semibold text-gray-900"
                data-translate="print_qr"
              >
                Print QR
              </div>
              <div class="text-sm text-gray-600">Physical copy</div>
            </div>
          </button>
        </div>
      </div>
    </div>

    <!-- Digital ID Card -->
    <div class="container mx-auto px-4 mb-8">
      <div class="bg-white rounded-2xl shadow-lg p-6">
        <h2
          class="text-xl font-semibold text-gray-900 mb-6"
          data-translate="digital_id_card"
        >
          Your Digital ID Card
        </h2>

        <!-- ID Card Display -->
        <div class="max-w-md mx-auto">
          <div
            class="bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-800 text-white p-6 rounded-2xl shadow-2xl relative overflow-hidden"
          >
            <!-- Background Pattern -->
            <div class="absolute inset-0 opacity-10">
              <div
                class="absolute top-0 right-0 w-32 h-32 bg-white rounded-full -translate-y-16 translate-x-16"
              ></div>
              <div
                class="absolute bottom-0 left-0 w-24 h-24 bg-white rounded-full translate-y-12 -translate-x-12"
              ></div>
            </div>

            <!-- Header -->
            <div class="relative">
              <div class="flex justify-between items-center mb-6">
                <div>
                  <h3 class="text-lg font-bold">MigrantConnect</h3>
                  <p class="text-blue-200 text-sm">Digital Worker ID</p>
                </div>
                <i class="fas fa-id-card text-2xl"></i>
              </div>

              <!-- Worker Photo and Basic Info -->
              <div class="flex items-center mb-6">
                <div
                  class="w-20 h-20 bg-white rounded-xl flex items-center justify-center mr-4"
                >
                  <i class="fas fa-user text-3xl text-blue-600"></i>
                </div>
                <div>
                  <h4 class="text-xl font-bold">Ram Kumar</h4>
                  <p class="text-blue-200">Construction Worker</p>
                  <p class="text-blue-200 text-sm">ID: MCW-DL-2024-1234</p>
                </div>
              </div>

              <!-- QR Code -->
              <div class="text-center mb-4">
                <div class="bg-white p-4 rounded-xl inline-block">
                  <div
                    id="qrcode"
                    class="w-32 h-32 bg-gray-100 flex items-center justify-center"
                  >
                    <i class="fas fa-qrcode text-4xl text-gray-400"></i>
                  </div>
                </div>
              </div>

              <!-- Footer -->
              <div class="text-center">
                <p class="text-blue-200 text-xs">Valid until: 31/12/2025</p>
                <p class="text-blue-200 text-xs">
                  Issued by: Government of Delhi
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Worker Information -->
    <div class="container mx-auto px-4 mb-8">
      <div class="bg-white rounded-2xl shadow-lg p-6">
        <h2
          class="text-xl font-semibold text-gray-900 mb-6"
          data-translate="worker_information"
        >
          Worker Information
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Personal Details -->
          <div class="space-y-4">
            <h3
              class="font-semibold text-gray-900 mb-4"
              data-translate="personal_details"
            >
              Personal Details
            </h3>
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-gray-600">Full Name:</span>
                <span class="font-medium">Ram Kumar</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Father's Name:</span>
                <span class="font-medium">Shyam Kumar</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Date of Birth:</span>
                <span class="font-medium">15/08/1985</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Gender:</span>
                <span class="font-medium">Male</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Aadhaar Number:</span>
                <span class="font-medium">**** **** **34</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Mobile Number:</span>
                <span class="font-medium">+91 98765 43210</span>
              </div>
            </div>
          </div>

          <!-- Work Details -->
          <div class="space-y-4">
            <h3
              class="font-semibold text-gray-900 mb-4"
              data-translate="work_details"
            >
              Work Details
            </h3>
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-gray-600">Primary Skill:</span>
                <span class="font-medium">Construction Worker</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Experience:</span>
                <span class="font-medium">8 Years</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Current Location:</span>
                <span class="font-medium">Delhi</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Home State:</span>
                <span class="font-medium">Uttar Pradesh</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Registration Date:</span>
                <span class="font-medium">01/01/2024</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Status:</span>
                <span class="font-medium text-green-600">Active</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Verification Status -->
    <div class="container mx-auto px-4 mb-8">
      <div class="bg-white rounded-2xl shadow-lg p-6">
        <h2
          class="text-xl font-semibold text-gray-900 mb-6"
          data-translate="verification_status"
        >
          Verification Status
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="text-center p-4 bg-green-50 rounded-xl">
            <i class="fas fa-check-circle text-3xl text-green-600 mb-3"></i>
            <h3
              class="font-semibold text-gray-900 mb-2"
              data-translate="identity_verified"
            >
              Identity Verified
            </h3>
            <p class="text-sm text-gray-600">
              Aadhaar authentication completed
            </p>
          </div>

          <div class="text-center p-4 bg-green-50 rounded-xl">
            <i class="fas fa-shield-check text-3xl text-green-600 mb-3"></i>
            <h3
              class="font-semibold text-gray-900 mb-2"
              data-translate="background_verified"
            >
              Background Verified
            </h3>
            <p class="text-sm text-gray-600">Police verification completed</p>
          </div>

          <div class="text-center p-4 bg-blue-50 rounded-xl">
            <i class="fas fa-certificate text-3xl text-blue-600 mb-3"></i>
            <h3
              class="font-semibold text-gray-900 mb-2"
              data-translate="skill_certified"
            >
              Skill Certified
            </h3>
            <p class="text-sm text-gray-600">Construction skills verified</p>
          </div>
        </div>
      </div>
    </div>

    <!-- How to Use QR Code -->
    <div class="container mx-auto px-4 mb-8">
      <div class="bg-white rounded-2xl shadow-lg p-6">
        <h2
          class="text-xl font-semibold text-gray-900 mb-6"
          data-translate="how_to_use_qr"
        >
          How to Use Your QR Code
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-4">
            <h3
              class="font-semibold text-gray-900 mb-4"
              data-translate="for_job_applications"
            >
              For Job Applications
            </h3>
            <div class="space-y-3">
              <div class="flex items-start">
                <div
                  class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-1"
                >
                  <span class="text-sm font-semibold text-blue-600">1</span>
                </div>
                <div>
                  <p class="font-medium text-gray-900">Show to Employer</p>
                  <p class="text-sm text-gray-600">
                    Present QR code during job interviews
                  </p>
                </div>
              </div>

              <div class="flex items-start">
                <div
                  class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-1"
                >
                  <span class="text-sm font-semibold text-blue-600">2</span>
                </div>
                <div>
                  <p class="font-medium text-gray-900">Quick Verification</p>
                  <p class="text-sm text-gray-600">
                    Employer can verify your details instantly
                  </p>
                </div>
              </div>

              <div class="flex items-start">
                <div
                  class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-1"
                >
                  <span class="text-sm font-semibold text-blue-600">3</span>
                </div>
                <div>
                  <p class="font-medium text-gray-900">Secure Hiring</p>
                  <p class="text-sm text-gray-600">
                    Helps employers make informed decisions
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="space-y-4">
            <h3
              class="font-semibold text-gray-900 mb-4"
              data-translate="for_services"
            >
              For Government Services
            </h3>
            <div class="space-y-3">
              <div class="flex items-start">
                <div
                  class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3 mt-1"
                >
                  <span class="text-sm font-semibold text-green-600">1</span>
                </div>
                <div>
                  <p class="font-medium text-gray-900">Service Access</p>
                  <p class="text-sm text-gray-600">
                    Use at government offices for quick service
                  </p>
                </div>
              </div>

              <div class="flex items-start">
                <div
                  class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3 mt-1"
                >
                  <span class="text-sm font-semibold text-green-600">2</span>
                </div>
                <div>
                  <p class="font-medium text-gray-900">Welfare Schemes</p>
                  <p class="text-sm text-gray-600">
                    Apply for benefits and subsidies
                  </p>
                </div>
              </div>

              <div class="flex items-start">
                <div
                  class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3 mt-1"
                >
                  <span class="text-sm font-semibold text-green-600">3</span>
                </div>
                <div>
                  <p class="font-medium text-gray-900">Digital Records</p>
                  <p class="text-sm text-gray-600">
                    Maintain digital trail of services used
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- QR Code Display Modal -->
    <div
      class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 hidden"
      id="qrModal"
    >
      <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4">
        <div class="p-6 border-b border-gray-100">
          <div class="flex justify-between items-center">
            <h3 class="text-xl font-semibold text-gray-900">Your QR Code</h3>
            <button
              onclick="closeQRModal()"
              class="text-gray-400 hover:text-gray-600"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        <div class="p-6 text-center">
          <div
            class="bg-white border-2 border-gray-200 p-6 rounded-xl inline-block mb-4"
          >
            <div
              id="largeQRCode"
              class="w-64 h-64 bg-gray-100 flex items-center justify-center"
            >
              <i class="fas fa-qrcode text-6xl text-gray-400"></i>
            </div>
          </div>
          <p class="text-sm text-gray-600 mb-4">
            Scan this QR code for instant verification
          </p>
          <div class="flex space-x-3">
            <button onclick="downloadQR()" class="btn-primary-modern flex-1">
              <i class="fas fa-download mr-2"></i>
              Download
            </button>
            <button onclick="shareQR()" class="btn-secondary-modern flex-1">
              <i class="fas fa-share mr-2"></i>
              Share
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="assets/js/qrcode.min.js"></script>
    <script src="assets/js/language.js"></script>
    <script>
      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize language system first
        if (typeof loadLanguage === "function") {
          const savedLang = localStorage.getItem("selectedLanguage") || "en";
          loadLanguage(savedLang);
        }

        generateQRCode();
        setupEventListeners();
      });

      function toggleLanguageDropdown() {
        const menu = document.getElementById("languageMenu");
        menu.classList.toggle("hidden");
      }

      // Close dropdown when clicking outside
      document.addEventListener("click", function (event) {
        const dropdown = document.getElementById("languageDropdown");
        const menu = document.getElementById("languageMenu");

        if (!dropdown.contains(event.target)) {
          menu.classList.add("hidden");
        }
      });

      function setupEventListeners() {
        // Add any event listeners here
      }

      function generateQRCode() {
        console.log("Generating QR code for ID card");

        // Worker data for QR code
        const workerData = {
          id: "MCW-DL-2024-1234",
          name: "Ram Kumar",
          skill: "Construction Worker",
          experience: "8 Years",
          location: "Delhi",
          verified: true,
          phone: "+91 98765 43210",
          issued: "2024-01-01",
        };

        const qrData = JSON.stringify(workerData);

        // Clear existing QR code
        const qrContainer = document.getElementById("qrcode");
        qrContainer.innerHTML = "";

        // Generate QR code for small display
        try {
          // Try using the CDN QRCode library first
          if (typeof QRCode !== "undefined" && QRCode.CorrectLevel) {
            console.log("Using QRCode library for small QR");
            const qrCode = new QRCode(qrContainer, {
              text: qrData,
              width: 128,
              height: 128,
              colorDark: "#1f2937",
              colorLight: "#ffffff",
              correctLevel: QRCode.CorrectLevel.M,
            });
          } else if (typeof window.QRCode !== "undefined") {
            console.log("Using window.QRCode library for small QR");
            // Create a canvas element
            const canvas = document.createElement("canvas");
            qrContainer.appendChild(canvas);
            window.QRCode.toCanvas(canvas, qrData, {
              width: 128,
              margin: 1,
              color: {
                dark: "#1f2937",
                light: "#ffffff",
              },
            });
          } else {
            console.log("Using QR API fallback for small QR");
            // Use QR API as fallback
            const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=128x128&data=${encodeURIComponent(
              qrData
            )}`;
            qrContainer.innerHTML = `<img src="${qrApiUrl}" alt="QR Code" style="width: 128px; height: 128px; border-radius: 4px;" crossorigin="anonymous" />`;
          }
          console.log("Small QR code generated successfully");
        } catch (error) {
          console.error("Error generating small QR code:", error);
          // Final fallback - use QR API
          const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=128x128&data=${encodeURIComponent(
            qrData
          )}`;
          qrContainer.innerHTML = `<img src="${qrApiUrl}" alt="QR Code" style="width: 128px; height: 128px; border-radius: 4px;" crossorigin="anonymous" />`;
        }
      }

      function showQRCode() {
        console.log("Show QR Code button clicked");

        const qrModal = document.getElementById("qrModal");
        const largeQRContainer = document.getElementById("largeQRCode");

        // Show the modal
        qrModal.classList.remove("hidden");
        qrModal.style.display = "flex";
        document.body.style.overflow = "hidden";

        // Clear existing content and show loading
        largeQRContainer.innerHTML = `
          <div class="flex items-center justify-center w-64 h-64 bg-gray-100 rounded-lg">
            <div class="text-center">
              <i class="fas fa-spinner fa-spin text-3xl text-gray-400 mb-2"></i>
              <p class="text-sm text-gray-500">Generating QR Code...</p>
            </div>
          </div>
        `;

        // Generate large QR code for modal
        const workerData = {
          id: "MCW-DL-2024-1234",
          name: "Ram Kumar",
          skill: "Construction Worker",
          experience: "8 Years",
          location: "Delhi",
          verified: true,
          phone: "+91 98765 43210",
          issued: "2024-01-01",
        };

        const qrData = JSON.stringify(workerData);
        console.log("Generating QR with data:", qrData);

        try {
          // Try multiple QR generation methods
          if (typeof QRCode !== "undefined" && QRCode.CorrectLevel) {
            console.log("Using QRCode library");
            const largeQRCode = new QRCode(largeQRContainer, {
              text: qrData,
              width: 256,
              height: 256,
              colorDark: "#1f2937",
              colorLight: "#ffffff",
              correctLevel: QRCode.CorrectLevel.M,
            });
          } else if (typeof window.QRCode !== "undefined") {
            console.log("Using window.QRCode library");
            // Create a canvas element
            const canvas = document.createElement("canvas");
            largeQRContainer.appendChild(canvas);
            window.QRCode.toCanvas(canvas, qrData, {
              width: 256,
              margin: 2,
              color: {
                dark: "#1f2937",
                light: "#ffffff",
              },
            });
          } else {
            console.log("Using QR API fallback");
            // Use QR API as fallback for large QR
            const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=${encodeURIComponent(
              qrData
            )}`;
            largeQRContainer.innerHTML = `<img src="${qrApiUrl}" alt="QR Code" style="width: 256px; height: 256px; border-radius: 8px;" crossorigin="anonymous" />`;
          }
        } catch (error) {
          console.error("Error generating large QR code:", error);
          // Final fallback - use QR API
          const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=${encodeURIComponent(
            qrData
          )}`;
          largeQRContainer.innerHTML = `<img src="${qrApiUrl}" alt="QR Code" style="width: 256px; height: 256px; border-radius: 8px;" crossorigin="anonymous" />`;
        }
      }

      function closeQRModal() {
        console.log("Closing QR modal");
        const qrModal = document.getElementById("qrModal");
        qrModal.classList.add("hidden");
        qrModal.style.display = "none";
        document.body.style.overflow = "auto";
      }

      // Close modal when clicking outside of it
      document.addEventListener("click", function (event) {
        const qrModal = document.getElementById("qrModal");
        if (event.target === qrModal) {
          closeQRModal();
        }
      });

      // Close modal with Escape key
      document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          const qrModal = document.getElementById("qrModal");
          if (!qrModal.classList.contains("hidden")) {
            closeQRModal();
          }
        }
      });

      function downloadQR() {
        console.log("Download QR button clicked");

        const workerData = {
          id: "MCW-DL-2024-1234",
          name: "Ram Kumar",
          skill: "Construction Worker",
          experience: "8 Years",
          location: "Delhi",
          verified: true,
          phone: "+91 98765 43210",
          issued: "2024-01-01",
        };

        const qrData = JSON.stringify(workerData);

        try {
          // Try to get QR code from the modal if it exists
          const largeQRContainer = document.getElementById("largeQRCode");
          const existingCanvas = largeQRContainer.querySelector("canvas");
          const existingImg = largeQRContainer.querySelector("img");

          if (existingCanvas) {
            // Download from existing canvas
            const link = document.createElement("a");
            link.download = "MigrantConnect-QR-" + workerData.id + ".png";
            link.href = existingCanvas.toDataURL();
            link.click();
            console.log("Downloaded QR from canvas");
          } else if (existingImg) {
            // Download from existing image
            const link = document.createElement("a");
            link.download = "MigrantConnect-QR-" + workerData.id + ".png";
            link.href = existingImg.src;
            link.target = "_blank";
            link.click();
            console.log("Downloaded QR from image");
          } else {
            // Generate new QR for download using API
            const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=512x512&format=png&data=${encodeURIComponent(
              qrData
            )}`;
            const link = document.createElement("a");
            link.download = "MigrantConnect-QR-" + workerData.id + ".png";
            link.href = qrApiUrl;
            link.target = "_blank";
            link.click();
            console.log("Downloaded QR from API");
          }

          // Show success message
          const successMsg = document.createElement("div");
          successMsg.innerHTML = `
            <div style="position: fixed; top: 20px; right: 20px; background: #16a34a; color: white; padding: 12px 20px; border-radius: 8px; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
              <i class="fas fa-check-circle mr-2"></i>QR Code downloaded successfully!
            </div>
          `;
          document.body.appendChild(successMsg);

          // Remove success message after 3 seconds
          setTimeout(() => {
            document.body.removeChild(successMsg);
          }, 3000);
        } catch (error) {
          console.error("Error downloading QR code:", error);
          alert("QR code download initiated! Check your downloads folder.");
        }
      }

      function shareQR() {
        console.log("Share QR button clicked");

        const workerData = {
          id: "MCW-DL-2024-1234",
          name: "Ram Kumar",
          skill: "Construction Worker",
        };

        const shareData = {
          title: "MigrantConnect Digital ID",
          text: `${workerData.name} - ${workerData.skill}\nWorker ID: ${workerData.id}\n\nVerify my credentials with MigrantConnect`,
          url: window.location.href,
        };

        if (navigator.share) {
          navigator
            .share(shareData)
            .then(() => console.log("Successfully shared"))
            .catch((error) => {
              console.log("Error sharing:", error);
              fallbackShare();
            });
        } else {
          fallbackShare();
        }

        function fallbackShare() {
          const textToShare = `${shareData.text}\n\nView profile: ${shareData.url}`;

          if (navigator.clipboard) {
            navigator.clipboard
              .writeText(textToShare)
              .then(() => {
                showNotification(
                  "Profile information copied to clipboard!",
                  "success"
                );
              })
              .catch(() => {
                legacyCopyToClipboard(textToShare);
              });
          } else {
            legacyCopyToClipboard(textToShare);
          }
        }

        function legacyCopyToClipboard(text) {
          const textArea = document.createElement("textarea");
          textArea.value = text;
          textArea.style.position = "fixed";
          textArea.style.opacity = "0";
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand("copy");
          document.body.removeChild(textArea);
          showNotification(
            "Profile information copied to clipboard!",
            "success"
          );
        }

        function showNotification(message, type = "info") {
          const notification = document.createElement("div");
          const bgColor = type === "success" ? "#16a34a" : "#2563eb";
          notification.innerHTML = `
            <div style="position: fixed; top: 20px; right: 20px; background: ${bgColor}; color: white; padding: 12px 20px; border-radius: 8px; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
              <i class="fas fa-${
                type === "success" ? "check-circle" : "info-circle"
              } mr-2"></i>${message}
            </div>
          `;
          document.body.appendChild(notification);

          setTimeout(() => {
            document.body.removeChild(notification);
          }, 3000);
        }
      }

      function printQR() {
        window.print();
      }

      function getCurrentLanguage() {
        return localStorage.getItem("selectedLanguage") || "en";
      }

      function updateLanguageDisplay() {
        const currentLang = getCurrentLanguage();
        const langDisplay = document.getElementById("currentLang");
        if (langDisplay) {
          const langNames = {
            en: "English",
            hi: "हिंदी",
            bn: "বাংলা",
            te: "తెలుగు",
            ta: "தமிழ்",
            mr: "मराठी",
            gu: "ગુજરાતી",
            kn: "ಕನ್ನಡ",
            ml: "മലയാളം",
            pa: "ਪੰਜਾਬੀ",
            or: "ଓଡ଼ିଆ",
          };
          langDisplay.textContent = langNames[currentLang] || "English";
        }
      }

      // Initialize language display on page load
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(updateLanguageDisplay, 100);
      });
    </script>
  </body>
</html>
